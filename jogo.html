<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>M√°quina de Pr√™mios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: radial-gradient(circle at top, #0a2a4a, #000);
    color: white;
    text-align: center;
}

/* ===== HEADER ===== */
header {
    background: #003366;
    padding: 20px 0;
    font-size: 26px;
    font-weight: bold;
    position: relative;
}

/* ===== BOT√ÉO VOLTAR ===== */
#back-btn-top {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    background: #003366;
    color: white;
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
}

#back-btn-top:hover {
    transform: translateY(-50%) scale(1.05);
    box-shadow: 0 0 15px #00bfff, 0 0 30px #00ffff;
}

#tickets {
    margin-top: 8px;
    font-size: 18px;
}

/* ===== M√ÅQUINA ===== */
#machine {
    position: relative;
    width: 320px;
    height: 420px;
    margin: 30px auto;
    background: linear-gradient(#111, #222);
    border-radius: 20px;
    border: 6px solid #00bfff;
    overflow: hidden;
}

#claw-line {
    position: absolute;
    top: 0;
    left: 50%;
    width: 2px;
    height: 0;
    background: silver;
    transform: translateX(-50%);
}

#claw {
    position: absolute;
    top: 0;
    width: 40px;
    height: 50px;
    background: linear-gradient(#ddd, #999);
    border-radius: 0 0 12px 12px;
    left: 140px;
}

.prize {
    position: absolute;
    bottom: 25px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    color: #002244;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
}

.common { background: #7CFC00; }
.medium { background: #00BFFF; }
.hard { background: #9370DB; }
.rare { background: gold; }

/* ===== CONTROLES ===== */
#controls button {
    padding: 14px 18px;
    margin: 8px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}

#grab {
    background: #00bfff;
    color: #002244;
}

#message {
    margin-top: 15px;
    font-weight: bold;
    min-height: 22px;
}
</style>
</head>

<body>

<header>
    <a href="cupons.html" id="back-btn-top">‚Üê Voltar</a>
    üéÅ M√°quina de Pr√™mios
    <div id="tickets"></div>
</header>

<div id="machine">
    <div id="claw-line"></div>
    <div id="claw"></div>

    <div class="prize common" data-coupon="CUPOM5" data-chance="0.6" style="left:30px;">5%</div>
    <div class="prize medium" data-coupon="CUPOM10" data-chance="0.4" style="left:100px;">10%</div>
    <div class="prize hard" data-coupon="CUPOM20" data-chance="0.25" style="left:170px;">20%</div>
    <div class="prize rare" data-coupon="FRETEGRATIS" data-chance="0.15" style="left:240px;">FRETE</div>
</div>

<div id="controls">
    <button onclick="moveClaw(-20)">‚¨ÖÔ∏è</button>
    <button onclick="moveClaw(20)">‚û°Ô∏è</button>
    <button id="grab" onclick="grab()">PEGAR</button>
</div>

<div id="message"></div>

<script>
// ========= TICKETS =========
const MAX = 3;
const RECOVER = 5 * 60 * 60 * 1000;

let tickets = JSON.parse(localStorage.getItem("tickets")) ?? MAX;
let last = JSON.parse(localStorage.getItem("lastTicketTime")) ?? Date.now();

function recoverTickets(){
    const now = Date.now();
    const diff = now - last;
    const add = Math.floor(diff / RECOVER);

    if(add > 0){
        tickets = Math.min(MAX, tickets + add);
        last += add * RECOVER;
        localStorage.setItem("tickets", tickets);
        localStorage.setItem("lastTicketTime", last);
    }
}

recoverTickets();
updateTickets();

function updateTickets(){
    document.getElementById("tickets").textContent = `üéü Tickets: ${tickets}/3`;
}

// ========= GARRA =========
const claw = document.getElementById("claw");
const line = document.getElementById("claw-line");
let x = 140;
let busy = false;

function moveClaw(dx){
    if(busy) return;
    x = Math.max(0, Math.min(280, x + dx));
    claw.style.left = x + "px";
}

// ========= JOGO =========
function grab(){
    if(busy) return;

    if(tickets <= 0){
        msg("Sem tickets ‚è±Ô∏è", "red");
        return;
    }

    tickets--;
    localStorage.setItem("tickets", tickets);
    updateTickets();

    busy = true;
    animateDown();
}

function animateDown(){
    let h = 0;
    const drop = setInterval(()=>{
        h += 10;
        line.style.height = h + "px";
        claw.style.top = h + "px";

        if(h >= 280){
            clearInterval(drop);
            checkWin();
        }
    }, 20);
}

function animateUp(){
    let h = parseInt(line.style.height);
    const up = setInterval(()=>{
        h -= 10;
        line.style.height = h + "px";
        claw.style.top = h + "px";

        if(h <= 0){
            clearInterval(up);
            busy = false;
        }
    }, 20);
}

function checkWin(){
    let win = null;

    document.querySelectorAll(".prize").forEach(p=>{
        const px = p.offsetLeft;
        const chance = parseFloat(p.dataset.chance);

        if(Math.abs(px - x) < 18 && Math.random() < chance){
            win = p.dataset.coupon;
            p.remove();
        }
    });

    setTimeout(()=>{
        animateUp();
        if(win){
            saveCoupon(win);
            msg("üéâ Voc√™ ganhou " + win, "#00ff99");
        } else {
            msg("üò¢ Escapou da garra!", "#ff6666");
        }
    }, 400);
}

function saveCoupon(code){
    let list = JSON.parse(localStorage.getItem("gameCoupons")) || [];
    if(!list.includes(code)){
        list.push(code);
        localStorage.setItem("gameCoupons", JSON.stringify(list));
    }
}

// ========= UI =========
function msg(text, color){
    const m = document.getElementById("message");
    m.textContent = text;
    m.style.color = color;
}
</script>

</body>
</html>
