<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>M√°quina de Pr√™mios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:"Segoe UI",Arial,sans-serif;
    background:radial-gradient(circle at top,#0a2a4a,#000);
    color:#fff;
    text-align:center;
}
header{
    background:#003366;
    padding:20px 0;
    font-size:26px;
    font-weight:bold;
    position:relative;
}
#back-btn-top{
    position:absolute;
    left:20px;
    top:50%;
    transform:translateY(-50%);
    background:#003366;
    color:white;
    padding:6px 12px;
    font-size:14px;
    border-radius:6px;
    text-decoration:none;
    font-weight:bold;
}
#tickets{margin-top:8px;font-size:18px}

/* ===== M√ÅQUINA ===== */
#machine{
    position:relative;
    width:320px;
    height:420px;
    margin:25px auto;
    background:linear-gradient(#111,#222);
    border-radius:20px;
    border:6px solid #00bfff;
    overflow:hidden;
}
#claw-line{
    position:absolute;
    top:0;
    left:50%;
    width:2px;
    height:0;
    background:silver;
    transform:translateX(-50%);
}
#claw{
    position:absolute;
    top:0;
    left:140px;
    width:40px;
    height:50px;
    background:linear-gradient(#ddd,#999);
    border-radius:0 0 12px 12px;
}
.prize{
    position:absolute;
    bottom:25px;
    width:50px;
    height:50px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    font-weight:bold;
    color:#002244;
}
.common{background:#7CFC00}
.medium{background:#00BFFF}
.hard{background:#9370DB}
.rare{background:gold}

/* ===== CONTROLES ===== */
#controls button{
    padding:14px 18px;
    margin:8px;
    font-size:16px;
    border-radius:12px;
    border:none;
    font-weight:bold;
    cursor:pointer;
}
#grab{background:#00bfff;color:#002244}

/* ===== TICKETS LIST ===== */
#tickets-panel{
    max-width:360px;
    margin:25px auto;
    background:rgba(255,255,255,.1);
    padding:15px;
    border-radius:14px;
    text-align:left;
}
#tickets-panel h3{
    margin:0 0 10px;
    text-align:center;
}
#search-ticket{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:none;
    margin-bottom:10px;
}
.ticket-item{
    background:#003366;
    padding:8px;
    border-radius:8px;
    margin-bottom:6px;
    font-size:13px;
}

/* ===== MENSAGEM ===== */
#message{margin-top:12px;font-weight:bold;min-height:20px}
</style>
</head>

<body>

<header>
    <a href="cupons.html" id="back-btn-top">‚Üê Voltar</a>
    üéÅ M√°quina de Pr√™mios
    <div id="tickets"></div>
</header>

<div id="machine">
    <div id="claw-line"></div>
    <div id="claw"></div>

    <div class="prize common" data-coupon="CUPOM5" data-chance="0.6" style="left:15px">5%</div>
    <div class="prize medium" data-coupon="CUPOM10" data-chance="0.45" style="left:70px">10%</div>
    <div class="prize medium" data-coupon="CUPOM15" data-chance="0.35" style="left:125px">15%</div>
    <div class="prize hard" data-coupon="CUPOM20" data-chance="0.25" style="left:180px">20%</div>
    <div class="prize hard" data-coupon="CUPOM30" data-chance="0.15" style="left:235px">30%</div>
    <div class="prize rare" data-coupon="FRETEGRATIS" data-chance="0.1" style="left:270px">FRETE</div>
</div>

<div id="controls">
    <button id="left-btn">‚¨ÖÔ∏è</button>
    <button id="right-btn">‚û°Ô∏è</button>
    <button id="grab">PEGAR</button>
</div>

<div id="message"></div>

<!-- PAINEL DE TICKETS -->
<div id="tickets-panel">
    <h3>üéüÔ∏è Hist√≥rico de Tickets</h3>
    <input id="search-ticket" placeholder="Pesquisar ticket ou comando">
    <div id="tickets-list"></div>
</div>

<script>
// ======== TICKETS ========
const MAX=3, RECOVER=5*60*60*1000;
let tickets=+localStorage.getItem("tickets")||MAX;
let last=+localStorage.getItem("lastTicketTime")||Date.now();
let history=JSON.parse(localStorage.getItem("ticketHistory"))||[];

function recover(){
    const now=Date.now();
    const add=Math.floor((now-last)/RECOVER);
    if(add>0){
        tickets=Math.min(MAX,tickets+add);
        for(let i=0;i<add;i++){
            history.push("Ticket recuperado - "+new Date().toLocaleString());
        }
        last+=add*RECOVER;
        save();
    }
}
function save(){
    localStorage.setItem("tickets",tickets);
    localStorage.setItem("lastTicketTime",last);
    localStorage.setItem("ticketHistory",JSON.stringify(history));
}
function renderTickets(){
    document.getElementById("tickets").textContent=`üéü Tickets: ${tickets}/3`;
    const list=document.getElementById("tickets-list");
    list.innerHTML="";
    const q=document.getElementById("search-ticket").value.toLowerCase();
    history.filter(h=>h.toLowerCase().includes(q)).forEach(h=>{
        const d=document.createElement("div");
        d.className="ticket-item";
        d.textContent=h;
        list.appendChild(d);
    });
}

recover(); renderTickets();

document.getElementById("search-ticket").addEventListener("input",e=>{
    if(e.target.value==="resetar.comando.//ticket"){
        tickets=MAX;
        history=[];
        save();
        e.target.value="";
        document.getElementById("message").textContent="‚úî Sistema sincronizado";
    }
    renderTickets();
});

// ======== GARRA ========
const claw=document.getElementById("claw"), line=document.getElementById("claw-line");
let x = 140, targetX = 140;
let busy=false;

// suaviza√ß√£o
function ease(current, target){ return current + (target-current)*0.15; }

function animateClaw(){
    x = ease(x, targetX);
    claw.style.left = x + "px";
    requestAnimationFrame(animateClaw);
}
animateClaw();

// bot√£o pressionado cont√≠nuo
let moveInterval = null;
document.getElementById("left-btn").addEventListener("mousedown",()=> moveInterval = setInterval(()=>targetX=Math.max(0,targetX-2),10));
document.getElementById("left-btn").addEventListener("mouseup", ()=> clearInterval(moveInterval));
document.getElementById("left-btn").addEventListener("mouseleave", ()=> clearInterval(moveInterval));
document.getElementById("right-btn").addEventListener("mousedown",()=> moveInterval = setInterval(()=>targetX=Math.min(280,targetX+2),10));
document.getElementById("right-btn").addEventListener("mouseup", ()=> clearInterval(moveInterval));
document.getElementById("right-btn").addEventListener("mouseleave", ()=> clearInterval(moveInterval));

// ======== PEGAR ========
document.getElementById("grab").addEventListener("click", grab);

function grab(){
    if(busy||tickets<=0) return;
    tickets--; history.push("Tentativa usada - "+new Date().toLocaleString());
    save(); renderTickets();
    busy=true;

    let h=0;
    // descida suave
    function drop(){
        h += (280-h)*0.18;
        line.style.height=h+"px";
        claw.style.top=h+"px";
        if(h<279) requestAnimationFrame(drop);
        else checkGrab();
    }
    drop();
}

function checkGrab(){
    let win=null;
    let grabbedPrize=null;
    document.querySelectorAll(".prize").forEach(p=>{
        if(Math.abs(p.offsetLeft-x)<18 && Math.random()<p.dataset.chance){
            win=p.dataset.coupon;
            grabbedPrize=p;
        }
    });

    // anima√ß√£o subida + pr√™mio
    let h=parseFloat(line.style.height);
    function lift(){
        h += (0-h)*0.18;
        line.style.height=h+"px";
        claw.style.top=h+"px";
        if(grabbedPrize){
            // segue garra
            grabbedPrize.style.bottom = (25 + h/2) + "px";
            grabbedPrize.style.left = x + "px";
        }
        if(h>1) requestAnimationFrame(lift);
        else finishGrab();
    }
    lift();

    function finishGrab(){
        if(win){
            let c=JSON.parse(localStorage.getItem("gameCoupons"))||[];
            if(!c.includes(win)){ c.push(win); localStorage.setItem("gameCoupons",JSON.stringify(c)); }
            if(grabbedPrize) grabbedPrize.remove();
            document.getElementById("message").textContent="üéâ Voc√™ ganhou "+win;
        }else{
            document.getElementById("message").textContent="üò¢ Escapou da garra";
        }
        busy=false;
    }
}
</script>

</body>
</html>
