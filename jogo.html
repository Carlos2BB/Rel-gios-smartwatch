<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>M√°quina de Pr√™mios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --blue:#00cfff;
    --dark:#021427;
    --metal:#bfc7d5;
}

body{
    margin:0;
    font-family:"Segoe UI",Arial,sans-serif;
    background:radial-gradient(circle at top,#0b2e4f,#000);
    color:#fff;
    text-align:center;
}

/* ===== HEADER ===== */
header{
    background:linear-gradient(#004c80,#002244);
    padding:18px 0 12px;
    font-size:26px;
    font-weight:bold;
    position:relative;
    box-shadow:0 4px 20px rgba(0,0,0,.6);
}
#back-btn-top{
    position:absolute;
    left:16px;
    top:50%;
    transform:translateY(-50%);
    background:#002244;
    color:white;
    padding:6px 12px;
    font-size:14px;
    border-radius:6px;
    text-decoration:none;
    font-weight:bold;
}
#tickets{
    font-size:16px;
    margin-top:6px;
}

/* ===== MACHINE ===== */
#machine-wrapper{
    margin:30px auto;
    width:360px;
}

#machine{
    position:relative;
    width:100%;
    height:460px;
    background:
        linear-gradient(145deg,#0a1f35,#020a14);
    border-radius:26px;
    padding:16px;
    box-shadow:
        inset 0 0 40px rgba(0,0,0,.9),
        0 0 30px rgba(0,207,255,.4);
}

/* metal frame */
#machine::before{
    content:"";
    position:absolute;
    inset:0;
    border-radius:26px;
    border:4px solid var(--metal);
    box-shadow:inset 0 0 15px rgba(255,255,255,.3);
    pointer-events:none;
}

/* glass */
#glass{
    position:absolute;
    inset:18px;
    background:linear-gradient(135deg,rgba(255,255,255,.12),rgba(255,255,255,.02));
    border-radius:18px;
    box-shadow:inset 0 0 20px rgba(255,255,255,.2);
    overflow:hidden;
}

/* ===== CLAW ===== */
#claw-line{
    position:absolute;
    top:0;
    left:50%;
    width:2px;
    background:#aaa;
    transform:translateX(-50%);
}
#claw{
    position:absolute;
    top:0;
    width:42px;
    height:54px;
    background:linear-gradient(#eee,#999);
    border-radius:0 0 14px 14px;
    box-shadow:0 4px 8px rgba(0,0,0,.6);
}

/* ===== PRIZES ===== */
.prize{
    position:absolute;
    bottom:22px;
    width:52px;
    height:52px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    font-weight:bold;
    color:#002244;
    box-shadow:
        inset 0 0 8px rgba(255,255,255,.6),
        0 4px 8px rgba(0,0,0,.6);
}
.common{background:#7CFC00}
.medium{background:#00BFFF}
.hard{background:#9370DB}
.rare{background:gold}

/* ===== CONTROLS ===== */
#controls button{
    padding:14px 18px;
    margin:10px 6px;
    font-size:16px;
    border-radius:14px;
    border:none;
    font-weight:bold;
    cursor:pointer;
    background:linear-gradient(#00d4ff,#0088cc);
    color:#002244;
    box-shadow:0 4px 10px rgba(0,0,0,.5);
}
#grab{
    background:linear-gradient(#ffe066,#ffb700);
}

/* ===== TABLE ===== */
#probabilities-panel{
    max-width:360px;
    margin:20px auto;
    background:rgba(255,255,255,.08);
    padding:14px;
    border-radius:14px;
}
#probabilities-panel h3{margin:0 0 8px}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    padding:6px;
    font-size:14px;
    border-bottom:1px solid var(--blue);
}
.highlight{
    background:rgba(0,207,255,.25);
}

/* ===== TICKETS ===== */
#tickets-panel{
    max-width:360px;
    margin:25px auto;
    background:rgba(255,255,255,.08);
    padding:14px;
    border-radius:14px;
    text-align:left;
}
#search-ticket{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:none;
}
.ticket-item{
    background:#003366;
    padding:8px;
    border-radius:8px;
    margin-top:6px;
    font-size:13px;
}

#message{margin-top:12px;font-weight:bold}
</style>
</head>

<body>

<header>
<a href="cupons.html" id="back-btn-top">‚Üê Voltar</a>
üéÅ M√°quina de Pr√™mios
<div id="tickets"></div>
</header>

<div id="machine-wrapper">
<div id="machine">
<div id="glass">
<div id="claw-line"></div>
<div id="claw"></div>

<div class="prize common" data-coupon="CUPOM5" data-chance="0.6" style="left:10px">5%</div>
<div class="prize medium" data-coupon="CUPOM10" data-chance="0.45" style="left:70px">10%</div>
<div class="prize medium" data-coupon="CUPOM15" data-chance="0.35" style="left:130px">15%</div>
<div class="prize hard" data-coupon="CUPOM20" data-chance="0.25" style="left:190px">20%</div>
<div class="prize hard" data-coupon="CUPOM30" data-chance="0.15" style="left:250px">30%</div>
<div class="prize rare" data-coupon="FRETEGRATIS" data-chance="0.1" style="left:300px">FRETE</div>

</div>
</div>
</div>

<div id="controls">
<button id="left-btn">‚¨ÖÔ∏è</button>
<button id="right-btn">‚û°Ô∏è</button>
<button id="grab">PEGAR</button>
</div>

<div id="message"></div>

<div id="probabilities-panel">
<h3>üìä Probabilidades</h3>
<table>
<thead><tr><th>Pr√™mio</th><th>Chance</th></tr></thead>
<tbody id="prob-body"></tbody>
</table>
</div>

<div id="tickets-panel">
<h3>üéüÔ∏è Hist√≥rico</h3>
<input id="search-ticket" placeholder="Pesquisar ou comando">
<div id="tickets-list"></div>
</div>

<script>
// ==== PROB TABLE ====
const probBody=document.getElementById("prob-body");
document.querySelectorAll(".prize").forEach(p=>{
    const tr=document.createElement("tr");
    tr.dataset.coupon=p.dataset.coupon;
    tr.innerHTML=`<td>${p.dataset.coupon}</td><td>${(p.dataset.chance*100).toFixed(1)}%</td>`;
    probBody.appendChild(tr);
});

// ==== HIGHLIGHT ====
function highlightPrize(){
    document.querySelectorAll("tbody tr").forEach(r=>r.classList.remove("highlight"));
    document.querySelectorAll(".prize").forEach(p=>{
        if(Math.abs(p.offsetLeft - x)<20){
            const row=document.querySelector(`tr[data-coupon="${p.dataset.coupon}"]`);
            if(row) row.classList.add("highlight");
        }
    });
}

// ==== TICKETS ====
const MAX=3, RECOVER=5*60*60*1000;
let tickets=+localStorage.getItem("tickets")||MAX;
let last=+localStorage.getItem("lastTicketTime")||Date.now();
let history=JSON.parse(localStorage.getItem("ticketHistory"))||[];

function save(){
    localStorage.setItem("tickets",tickets);
    localStorage.setItem("lastTicketTime",last);
    localStorage.setItem("ticketHistory",JSON.stringify(history));
}
function renderTickets(){
    document.getElementById("tickets").textContent=`üéü ${tickets}/3`;
    const list=document.getElementById("tickets-list");
    list.innerHTML="";
    history.forEach(h=>{
        const d=document.createElement("div");
        d.className="ticket-item";
        d.textContent=h;
        list.appendChild(d);
    });
}
renderTickets();

// ==== GARRA ====
const claw=document.getElementById("claw"), line=document.getElementById("claw-line");
let x=150, targetX=150, busy=false;

function ease(c,t){return c+(t-c)*0.15}
(function anim(){
    x=ease(x,targetX);
    claw.style.left=x+"px";
    highlightPrize();
    requestAnimationFrame(anim);
})();

let mv=null;
left-btn.onmousedown=()=>mv=setInterval(()=>targetX=Math.max(0,targetX-2),10);
right-btn.onmousedown=()=>mv=setInterval(()=>targetX=Math.min(300,targetX+2),10);
document.onmouseup=()=>clearInterval(mv);

// ==== PEGAR ====
grab.onclick=()=>{
if(busy||tickets<=0)return;
tickets--;history.push("Tentativa usada "+new Date().toLocaleString());save();renderTickets();
busy=true;let h=0;
(function drop(){
    h+=(300-h)*0.18;
    line.style.height=h+"px";
    claw.style.top=h+"px";
    if(h<299)requestAnimationFrame(drop);
    else finish();
})();
};

function finish(){
let win=null;
document.querySelectorAll(".prize").forEach(p=>{
    if(Math.abs(p.offsetLeft-x)<18 && Math.random()<p.dataset.chance) win=p;
});
setTimeout(()=>{
    line.style.height="0"; claw.style.top="0"; busy=false;
    if(win){
        let c=JSON.parse(localStorage.getItem("gameCoupons"))||[];
        if(!c.includes(win.dataset.coupon))c.push(win.dataset.coupon);
        localStorage.setItem("gameCoupons",JSON.stringify(c));
        win.remove();
        message.textContent="üéâ Voc√™ ganhou "+win.dataset.coupon;
    }else message.textContent="üò¢ Escapou da garra";
},400);
}
</script>

</body>
</html>
